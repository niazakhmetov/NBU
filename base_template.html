<!DOCTYPE html>
<html lang="{{ L.language_code | default('ru') }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {# Заголовок страницы будет уникален для каждого шаблона, используя Jinja-переменную L #}
    <title>{% block title %}{{ L.nav_main | default('Главная') }}{% endblock title %} | TengeHub</title>
    <link rel="stylesheet" href="styles/main.css"> 
</head>
<body>
    
    {# =================================================================
       1. ШАПКА И НАВИГАЦИЯ (Использование классов .navbar и .logo)
       ================================================================= #}
    <header>
        <div class="container navbar">
            <div class="logo">TengeHub</div> 
            
            <nav>
                {# Навигация теперь находится в базовом шаблоне #}
                <a href="index.html" {% if L.nav_main == title_key %}class="active"{% endif %}>{{ L.nav_main }}</a>
                <a href="full_rates.html" {% if L.nav_all_rates == title_key %}class="active"{% endif %}>{{ L.nav_all_rates }}</a>
                <a href="about.html" {% if L.nav_about == title_key %}class="active"{% endif %}>{{ L.nav_about }}</a>
                <a href="status.html" {% if L.nav_status == title_key %}class="active"{% endif %}>{{ L.nav_status | default('Статус') }}</a> 
            </nav>
            
            {# ⭐ Мультиязычность: Строгое оформление #}
            <div id="language-switcher">
                {# Используем общий стиль кнопок (.theme-toggle, как нейтральная кнопка) #}
                <button class="theme-toggle" onclick="setLang('ru')" data-lang="ru">RU</button>
                <button class="theme-toggle" onclick="setLang('kz')" data-lang="kz">KZ</button>
                <button class="theme-toggle" onclick="setLang('en')" data-lang="en">EN</button>
            </div>
        </div>
    </header>
    
    {# =================================================================
       2. ОСНОВНОЙ КОНТЕНТ (Уникальная часть каждой страницы)
       ================================================================= #}
    <main class="container">
        {% block content %}{% endblock content %}
    </main>
    
    {# =================================================================
       3. ВЕРХНИЙ ФУТЕР (Расширяемый блок для, например, секции "Партнеры")
       ================================================================= #}
    {% block extra_footer_content %}
        {# Дочерние шаблоны могут переопределить этот блок, чтобы добавить контент #}
    {% endblock extra_footer_content %}
    
    {# =================================================================
       4. НИЖНИЙ ФУТЕР (Минималистичный, статичный для всех страниц)
       ================================================================= #}
    <footer>
        <div class="container footer-minimal-content">
            <p class="footer-source-text">
                &copy; {{ now().strftime('%Y') | default('2025') }} TengeHub. 
                {# Добавлен data-key для динамического обновления скриптом #}
                <span class="source-info" data-key="footer_data_source">{{ L.footer_data_source | default('Данные получены с официального SOAP-сервиса Национального Банка РК.') }}</span>
            </p>
        </div>
    </footer>

    {# =================================================================
       5. JS ДЛЯ МУЛЬТИЯЗЫЧНОСТИ (Сохранен без изменений функционала)
       ================================================================= #}
    <script>
        const MESSAGES_DATA = JSON.parse('{{ MESSAGES | tojson }}'); 
        let currentLang = '{{ L.language_code | default("ru") }}'; 
        
        // Вспомогательная функция для получения ключа из текста ссылки
        function getKeyFromText(text) {
             for (const key in MESSAGES_DATA.ru) {
                if (MESSAGES_DATA.ru[key] === text) {
                    return key;
                }
             }
             return null;
        }

        // Функция для обновления текстов на странице
        function setLang(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            const messages = MESSAGES_DATA[lang];

            // Обновление активного состояния кнопок
            document.querySelectorAll('#language-switcher button').forEach(btn => {
                if (btn.getAttribute('data-lang') === lang) {
                    btn.style.backgroundColor = 'var(--color-brand-secondary)';
                    btn.style.color = 'var(--color-text-light)';
                } else {
                    btn.style.backgroundColor = 'var(--color-background-card)';
                    btn.style.color = 'var(--color-text-primary)';
                }
            });
            
            // Обновление всех элементов с data-key
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.getAttribute('data-key');
                const text = messages && messages[key] ? messages[key] : element.textContent;
                
                element.textContent = text;
            });

            // Обновление навигационных ссылок
            document.querySelectorAll('nav a').forEach(link => {
                const ruText = link.textContent; // Берем текущий текст как ключ для поиска
                const key = getKeyFromText(ruText); // Ищем ключ по русскому тексту
                
                if (key && messages[key]) {
                    link.textContent = messages[key];
                }
            });

            // Обновление заголовка страницы (Title)
            document.title = (messages['nav_about'] || 'О проекте') + ' | TengeHub';
        }

        // Установка начального языка при загрузке страницы
        window.onload = () => {
             // Инициализируем Title на основе текущего языка
            const initialTitleKey = '{{ L.nav_about | default('О проекте') }}'; 
            document.title = (MESSAGES_DATA[currentLang][getKeyFromText(initialTitleKey)] || initialTitleKey) + ' | TengeHub';

            setLang(currentLang);
        };
    </script>
</body>
</html>
