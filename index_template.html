<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ L.title }} | TengeHub</title>
    
    {# ⭐ КРИТИЧЕСКОЕ ИЗМЕНЕНИЕ: Подключение единого файла стилей #}
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    
    {# =================================================================
       1. ШАПКА И НАВИГАЦИЯ (Использование классов .navbar и .logo)
       ================================================================= #}
    <header>
        <div class="container navbar">
            {# Заменен h1 на div.logo для чистого корпоративного вида #}
            <div class="logo">TengeHub</div> 
            
            <nav>
                {# Устанавливаем активный класс для текущей страницы #}
                <a href="index.html" class="active">{{ L.nav_main }}</a>
                <a href="full_rates.html">{{ L.nav_all_rates }}</a>
                <a href="about.html">{{ L.nav_about }}</a>
                <a href="status.html">{{ L.nav_status }}</a> 
            </nav>
        </div>
    </header>

    {# =================================================================
       2. ОСНОВНОЙ КОНТЕНТ (Использование класса .container и .card)
       ================================================================= #}
    <div class="container">
        
        <div class="card">
            
            {# Строгий заголовок #}
            <h2>{{ L.h1_main_rates }}</h2>
            
            <p>
                {{ L.data_actual_on }}: 
                <span style="font-weight: 600; color: var(--color-brand-primary);">{{ course_date }}</span>
            </p>
            <p style="margin-bottom: 25px;">
                {{ L.description }}
            </p>

            <section class="main-rates">
                
                {# Использование класса .data-table из main.css #}
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 8%;">Код</th>
                            <th style="width: 40%;">{{ L.CURRENCY_NAME }}</th>
                            <th style="width: 15%;">Кол-во</th>
                            <th style="width: 25%; text-align: right;">{{ L.RATE_NAME }} (за 1 KZT)</th>
                            <th style="width: 12%; text-align: right;">{{ L.CHANGE }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for rate in rates %}
                        <tr>
                            <td>{{ rate.code }}</td>
                            <td>{{ rate.full_name }}</td>
                            <td>{{ rate.quant }}</td>
                            <td style="text-align: right; font-weight: 500;">{{ "%.4f" | format(rate.course) }}</td> 
                            {# Использование классов .change-up/.change-down из main.css #}
                            <td class="{% if rate.change > 0 %}change-up{% elif rate.change < 0 %}change-down{% else %}change-neutral{% endif %}" style="text-align: right;">
                                {% if rate.change > 0 %}+{% endif %}
                                {{ "%.4f" | format(rate.change) }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <p style="text-align: right; margin-top: 20px;">
                    <a href="full_rates.html" style="font-weight: 600;">
                        {{ L.nav_all_rates }} &rarr;
                    </a>
                </p>
            </section>
        </div>
        
        {# =================================================================
           3. БЛОК ВЕРИФИКАЦИИ (Использование классов, улучшенная структура)
           ================================================================= #}
        <div class="card verification-box" style="display: flex; align-items: center; background: var(--color-background-page); border: 1px solid var(--color-border);">
            
            <div class="qr-code" style="flex-shrink: 0; margin-right: 20px; border: 1px solid var(--color-border); padding: 5px; background: var(--color-background-card);">
                {# ⭐ КРИТИЧЕСКОЕ ИСПРАВЛЕНИЕ: Добавлен префикс data:image/png;base64, #}
                <img src="data:image/png;base64,{{ global_qr_code_base64 }}" 
                     alt="QR Code для верификации курсов" 
                     style="width: 120px; height: 120px; display: block;">
            </div>
            
            <div class="verification-text">
                <p style="font-weight: 600; color: var(--color-brand-primary);">
                    {{ L.qr_verification_text | safe }} <b>{{ course_date }}</b>.
                </p>
                <p>
                    <small style="color: var(--color-text-secondary);">
                        {{ L.qr_disclaimer }}
                    </small>
                </p>
                <p style="margin-top: 10px;">
                    <a href="verify.html?d={{ course_date }}" style="font-weight: 600;">
                        Перейти на страницу верификации &rarr;
                    </a>
                </p>
            </div>
        </div>
    </div>
    
    {# =================================================================
       4. ПОДВАЛ (Использование тега <footer> и стилей из main.css)
       ================================================================= #}
    <footer>
        <div class="container">
            <p style="margin-bottom: 10px;">
                <a href="about.html" style="font-weight: 600; color: var(--color-brand-primary);">
                    {{ L.partner_title }}
                </a>
            </p>
            <p>
                <small>{{ L.partner_text }}</small>
            </p>
            <p style="margin-top: 15px;">
                &copy; {{ now().strftime('%Y') | default('2025') }} TengeHub. 
                <span style="font-weight: 600;">{{ L.source_p }}</span>
            </p>
        </div>
    </footer>
</body>
</html>
