<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ L.title | default('–û–±–º–µ–Ω–Ω—ã–µ –∫—É—Ä—Å—ã') }} | TengeHub</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    
    {# =================================================================
       1. –®–ê–ü–ö–ê, –ù–ê–í–ò–ì–ê–¶–ò–Ø –ò –ö–û–ù–¢–†–û–õ–´ (–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω)
       ================================================================= #}
    <header>
        <div class="container navbar">
            <div class="logo">TengeHub</div> 
            
            <nav>
                <a href="index.html" class="active">{{ L.nav_main | default('–ì–ª–∞–≤–Ω–∞—è') }}</a>
                <a href="full_rates.html">{{ L.nav_all_rates | default('–í—Å–µ –∫—É—Ä—Å—ã') }}</a>
                <a href="status.html">{{ L.nav_status | default('–°—Ç–∞—Ç—É—Å') }}</a>
                <a href="about.html">{{ L.nav_about | default('–û –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ') }}</a>
            </nav>
            
            <div class="controls-group">
                <div id="language-switcher">
                    <button class="theme-toggle" onclick="setLang('ru')" data-lang="ru">RU</button>
                    <button class="theme-toggle" onclick="setLang('kz')" data-lang="kz">KZ</button>
                    <button class="theme-toggle" onclick="setLang('en')" data-lang="en">EN</button>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle-btn">
                    ‚òÄÔ∏è
                </button>
            </div>
        </div>
    </header>
    
    {# =================================================================
       2. –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ (–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª–∞—Å—Å—ã .container, .card)
       ================================================================= #}
    <main class="container">
        
        <h1 style="margin-bottom: 25px;">
            {# –ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ–º L.title –∏–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ #}
            {{ L.title | default('–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ë–∞–Ω–∫–∞ –†–ö') }}
        </h1>
        
        {# --- –ë–õ–û–ö: –ö–†–ê–¢–ö–ò–ô –°–¢–ê–¢–£–° (–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω) --- #}
        <section class="card" style="margin-top: 20px; padding: 15px 30px; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; border-left: 5px solid var(--color-brand-primary);">
            <div style="margin-right: 20px; margin-bottom: 10px;">
                <span style="font-weight: 600; color: var(--color-text-primary);">
                    {{ L.status_sync | default('–°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:') }}
                </span>
                <span id="api-status" class="change-up" style="font-size: 1.1em; margin-left: 5px;">
                    {{ api_status | default('–£–°–ü–ï–®–ù–û') }}
                </span>
            </div>
            <div style="margin-bottom: 10px;">
                <span style="font-weight: 600; color: var(--color-text-primary);">
                    {{ L.status_last_update_time | default('–í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:') }}
                </span>
                <span id="update-time" style="color: var(--color-brand-secondary); margin-left: 5px;">
                    {{ update_time | default('05:50:48 27.11.2025') }}
                </span>
            </div>
        </section>

        {# --- –ë–õ–û–ö –° –î–ê–¢–û–ô –ê–ö–¢–£–ê–õ–¨–ù–û–°–¢–ò –ö–£–†–°–û–í (–ö–∞—Ä—Ç–æ—á–∫–∞) --- #}
        <section class="card" style="margin-top: 20px;">
            <p style="color: var(--color-text-secondary); margin-bottom: 5px;">
                {{ L.data_actual_on | default('–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ë–∞–Ω–∫–∞ –†–ö, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞') }}:
            </p>
            <h2 style="font-size: 1.8em; color: var(--color-text-primary);">
                {{ course_date | default('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö') }}
            </h2>
            <p>{{ L.description }}</p>
        </section>
        

        {# --- –¢–ê–ë–õ–ò–¶–ê –ö–£–†–°–û–í (–ò—Å–ø–æ–ª—å–∑—É–µ—Ç .data-table) --- #}
        <section class="card" style="padding: 0; margin-top: 30px;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 5%;">–ö–æ–¥</th>
                        <th style="width: 45%;">{{ L.CURRENCY_NAME | default('–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ') }}</th>
                        <th style="width: 20%; text-align: center;">–ö–æ–ª-–≤–æ</th>
                        <th style="width: 20%; text-align: center;">{{ L.RATE_NAME | default('–ö—É—Ä—Å (KZT)') }}</th>
                        <th style="width: 10%; text-align: right;">{{ L.CHANGE | default('–ò–∑–º–µ–Ω–µ–Ω–∏–µ') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {# ‚≠ê –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π 'rates' (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω) #}
                    {% for rate in rates %}
                    <tr>
                        <td data-label="–ö–æ–¥">{{ rate.code }}</td>
                        <td data-label="{{ L.CURRENCY_NAME }}">{{ rate.full_name }}</td>
                        <td data-label="–ö–æ–ª-–≤–æ" style="text-align: center;">{{ rate.quant }}</td>
                        <td data-label="{{ L.RATE_NAME }}" style="text-align: center;">{{ "%.4f" | format(rate.course) }}</td> 
                        
                        <td data-label="{{ L.CHANGE }}"
                            class="{% if rate.change > 0 %}change-up{% elif rate.change < 0 %}change-down{% endif %}"
                            style="text-align: right;">
                            {% if rate.change > 0 %}+{% endif %}
                            {{ "%.4f" | format(rate.change) }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <p style="text-align: right; margin: 20px 30px 20px 0;">
                <a href="full_rates.html">{{ L.nav_all_rates | default('–í—Å–µ –∫—É—Ä—Å—ã') }} &rarr;</a>
            </p>
        </section>

        {# --- –ë–õ–û–ö QR-–í–ï–†–ò–§–ò–ö–ê–¶–ò–ò (–ò—Å–ø–æ–ª—å–∑—É–µ—Ç .card) --- #}
        <section class="card" style="margin-top: 30px; display: flex; align-items: center; background-color: var(--color-background-secondary); border: 1px solid var(--color-border-primary);">
            <div class="qr-code" style="flex-shrink: 0; margin-right: 20px; border: 1px solid var(--color-border-secondary);">
                {# –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ QR-–∫–æ–¥–∞ #}
                <img src="{{ global_qr_code_base64 }}" 
                      alt="{{ L.qr_code_alt | default('QR Code –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫—É—Ä—Å–æ–≤') }}" 
                      style="width: 120px; height: 120px; display: block;">
            </div>
            
            <div class="verification-text">
                <p>
                    {# ‚≠ê –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ L.qr_verification_text –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞ #}
                    {{ L.qr_verification_text | safe }} **{{ course_date }}**.
                </p>
                <p>
                    <small>{{ L.qr_instruction | default('–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –∏–ª–∏ —Å–∫–∞–Ω–µ—Ä –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.') }}</small>
                </p>
            </div>
        </section>

    </main>
    
    {# =================================================================
       3. –ù–ò–ñ–ù–ò–ô –§–£–¢–ï–† (–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —à–∞–±–ª–æ–Ω)
       ================================================================= #}
    <footer>
        <div class="container footer-minimal-content">
            <p class="footer-source-text">
                &copy; {{ now().strftime('%Y') | default('2025') }} TengeHub. 
                <span class="source-info">{{ L.footer_data_source | default('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ SOAP-—Å–µ—Ä–≤–∏—Å–∞ –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ë–∞–Ω–∫–∞ –†–ö.') }}</span>
            </p>
        </div>
    </footer>
    
    {# =================================================================
       4. JS –î–õ–Ø –ú–£–õ–¨–¢–ò–Ø–ó–´–ß–ù–û–°–¢–ò –ò –¢–ï–ú–´ (–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω)
       ================================================================= #}
    <script>
        // --- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞: –ü–ï–†–ï–ó–ê–ì–†–£–ñ–ê–ï–¢ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –Ω–æ–≤—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º lang ---
        function setLang(lang) {
            const url = new URL(window.location.href);
            url.searchParams.set('lang', lang);
            window.location.href = url.toString();
        }
        
        // --- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã ---
        function toggleTheme() {
            const body = document.body;
            const btn = document.getElementById('theme-toggle-btn');
            
            body.classList.toggle('dark-theme');
            
            const isDark = body.classList.contains('dark-theme');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            
            btn.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
        }

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ---
        window.onload = () => {
            // ‚≠ê –ü—Ä–∏–Ω–∏–º–∞–µ–º —Ç–µ–∫—É—â–∏–π —è–∑—ã–∫ –∏–∑ Jinja
            const currentLang = '{{ L.language_code | default("ru") }}'; 
            
            // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–∞: –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('#language-switcher button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-lang') === currentLang) {
                    btn.classList.add('active'); 
                }
            });

            // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
            const savedTheme = localStorage.getItem('theme');
            const btn = document.getElementById('theme-toggle-btn');
            
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                btn.textContent = 'üåô';
            } else {
                document.body.classList.remove('dark-theme');
                btn.textContent = '‚òÄÔ∏è';
            }
        };
    </script>
</body>
</html>
